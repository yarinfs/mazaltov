<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>×™×•× ×”×•×œ×“×ª ×œ××‘×!</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --mario-red: #E52521;
            --pipe-green: #00c300;
            --pipe-dark: #008000;
            --coin-gold: #FFD700;
            --dirt-base: #5c3c20;
            --bg-panel: #ffffff;
            --app-height: 100%;
        }

        html {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
            background-color: #000;
        }

        body {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            overscroll-behavior: none;
            font-family: 'Rubik', sans-serif;
            -webkit-overflow-scrolling: auto;
        }

        * {
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }

        .app-wrapper {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: var(--app-height);
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            transition: height 0.15s ease-out;
            touch-action: none;
        }

        .app-wrapper.keyboard-open {
            align-items: flex-start;
            padding-top: 15px;
            padding-bottom: 10px;
        }

        #bg-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: -10;
            pointer-events: none;
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.1) 50%);
            background-size: 100% 4px;
            pointer-events: none;
            z-index: 100;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: -5;
            pointer-events: none;
        }

        .game-panel {
            background-color: var(--bg-panel);
            width: 90%; 
            max-width: 400px;
            max-height: calc(100% - 30px);
            padding: 20px;
            text-align: center; 
            position: relative; 
            display: none;
            flex-direction: column;
            border: 4px solid black;
            border-radius: 15px;
            box-shadow: 10px 10px 0px rgba(0,0,0,0.6);
            z-index: 200;
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        .keyboard-open .game-panel {
            padding: 15px;
            max-height: calc(100% - 20px);
        }

        .active { 
            display: flex;
            animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }
        
        @keyframes popIn { 
            0% { transform: scale(0.8); opacity: 0; } 
            100% { transform: scale(1); opacity: 1; } 
        }

        h1 {
            font-weight: 900;
            font-size: 1.8rem;
            margin: 0 0 10px 0;
            color: var(--mario-red);
            text-shadow: 2px 2px 0 #000;
            -webkit-text-stroke: 1px black;
            flex-shrink: 0;
        }
        
        .intro-text {
            font-weight: 700;
            font-size: 1rem;
            color: #333;
            margin-bottom: 20px;
            line-height: 1.4;
            flex-shrink: 0;
        }

        .keyboard-open .intro-text {
            font-size: 0.9rem;
            margin-bottom: 15px;
        }

        .hud-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            background: var(--pipe-green);
            padding: 8px 12px;
            border-radius: 10px;
            margin-bottom: 12px;
            border: 3px solid #000;
            box-shadow: inset 0 4px 0 rgba(255,255,255,0.3), inset 0 -4px 0 rgba(0,0,0,0.2);
            flex-shrink: 0;
        }

        .keyboard-open .hud-container {
            padding: 6px 10px;
            margin-bottom: 8px;
            gap: 15px;
        }

        .hud-item {
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-shadow: 1px 1px 0 #000;
            min-width: 60px;
        }

        .timer-text {
            font-size: 1.6rem;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
            font-weight: 900;
            line-height: 1;
        }

        .timer-label {
            font-size: 0.7rem;
            color: #e0ffd4;
            margin-bottom: 2px;
        }

        .question-label {
            margin: 0 0 5px 0;
            font-weight: bold;
            color: #555;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .math-block {
            background-color: var(--dirt-base);
            background-image:
                linear-gradient(45deg, rgba(0,0,0,0.2) 25%, transparent 25%, transparent 75%, rgba(0,0,0,0.2) 75%),
                linear-gradient(135deg, rgba(255,255,255,0.1) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.1) 75%);
            background-size: 20px 20px;
            border: 4px solid #000;
            padding: 15px;
            margin: 8px 0;
            color: #fff;
            font-size: 2.2rem;
            font-weight: 900; 
            text-shadow: 3px 3px 0 #000;
            -webkit-text-stroke: 2px black;
            direction: ltr;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.6);
            flex-shrink: 0;
        }

        .keyboard-open .math-block {
            padding: 10px;
            font-size: 1.8rem;
            margin: 5px 0;
        }

        .btn {
            background-color: var(--pipe-green);
            color: white;
            font-family: 'Rubik', sans-serif;
            font-weight: 900;
            font-size: 1.3rem;
            padding: 12px 0;
            width: 100%;
            border: 3px solid #000;
            border-radius: 10px;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 5px 0 var(--pipe-dark);
            transition: transform 0.1s, box-shadow 0.1s;
            touch-action: manipulation;
            flex-shrink: 0;
            -webkit-appearance: none;
        }

        .btn:active {
            transform: translateY(5px);
            box-shadow: 0 0 0 var(--pipe-dark);
        }

        .btn-start {
            background-color: var(--mario-red);
            box-shadow: 0 5px 0 #8a0000;
        }

        .btn-start:active {
            box-shadow: 0 0 0 #8a0000;
        }

        .btn:disabled {
            background-color: #999;
            box-shadow: 0 5px 0 #666;
            cursor: wait;
        }

        .keyboard-open .btn {
            padding: 10px 0;
            font-size: 1.1rem;
            margin-top: 8px;
        }

        input[type="tel"] {
            width: 100%;
            padding: 12px;
            font-family: 'Rubik', sans-serif;
            font-weight: 900;
            font-size: 1.8rem;
            text-align: center;
            border: 3px solid #000;
            border-radius: 10px;
            background: #fff;
            margin-bottom: 8px;
            outline: none;
            flex-shrink: 0;
            -webkit-appearance: none;
            appearance: none;
            transition: background-color 0.2s, border-color 0.2s, color 0.2s;
        }

        input[type="tel"]:focus {
            border-color: var(--mario-red);
            box-shadow: 0 0 0 3px rgba(229, 37, 33, 0.3);
        }

        .keyboard-open input[type="tel"] {
            padding: 10px;
            font-size: 1.5rem;
        }

        /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
           BRIGHTER RED ERROR STATE
           â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
        input[type="tel"].input-error {
            background: #ff0000 !important;
            border-color: #990000 !important;
            color: #fff !important;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            animation: errorShake 0.5s ease-in-out;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.8), 
                        0 0 40px rgba(255, 0, 0, 0.4),
                        inset 0 0 15px rgba(0,0,0,0.3) !important;
        }

        input[type="tel"].input-error::placeholder {
            color: rgba(255,255,255,0.9);
        }

        @keyframes errorShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }

        .win-title {
            color: var(--coin-gold);
            -webkit-text-stroke: 1.5px black;
            text-shadow: 3px 3px 0 #000;
            animation: winZoom 1s infinite alternate;
        }

        .note {
            background: #fff8dc;
            border: 3px dashed var(--coin-gold);
            padding: 12px;
            font-size: 1rem;
            line-height: 1.4;
            border-radius: 10px;
            margin-bottom: 15px;
            font-weight: bold;
            flex-shrink: 0;
        }

        @keyframes winZoom {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }

        .fail-screen {
            background: #220000;
            border: 4px solid var(--mario-red);
        }

        .fail-text {
            color: var(--mario-red);
            font-size: 2.2rem;
            text-shadow: 2px 2px 0 #000;
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    <video id="bg-video" autoplay muted loop playsinline webkit-playsinline>
        <source src="background.mp4" type="video/mp4">
    </video>
    <div class="overlay"></div>

    <div class="app-wrapper" id="app-wrapper">
        
        <!-- ×©×œ×‘ 1: ×¤×ª×™×—×” -->
        <div id="screen-1" class="game-panel active">
            <h1>×ª×¢×¦×•×¨! ğŸ›‘</h1>
            <p class="intro-text">
                ×œ×¤× ×™ ×©××ª×—×™×œ×™× ×× ×™ ×¦×¨×™×š ×œ×‘×“×•×§ ×× ××ª×” ×‘×××ª ××‘× ×©×œ×™.
                ×‘×©×‘×™×œ ×–×” ×”×›× ×ª×™ ×œ×š ××‘×—×Ÿ ×‘×—×©×‘×•×Ÿ ×©×‘×• ××ª×” ×¦×¨×™×š ×œ×”×¨××•×ª ××ª ×”××”×™×¨×•×ª ×©×œ×š!
            </p>
            <button class="btn btn-start" id="init-game-btn" disabled>×˜×•×¢×Ÿ ×¡××•× ×“...</button>
        </div>

        <!-- ×©×œ×‘ 2: ××©×—×§ -->
        <div id="screen-2" class="game-panel">
            <div class="hud-container">
                <div class="hud-item">
                    <span class="timer-label">×–××Ÿ</span>
                    <span id="time-left" class="timer-text">60</span>
                </div>
                <div class="hud-item">
                    <span class="timer-label">×©××œ×”</span>
                    <span id="question-counter" class="timer-text">1/4</span>
                </div>
                <div class="hud-item">
                    <span class="timer-label">×—×™×™×</span>
                    <span id="lives-display" style="font-size: 1.2rem;">â¤ï¸â¤ï¸â¤ï¸</span>
                </div>
            </div>

            <p class="question-label">×ª×¤×ª×•×¨ ××ª ×”×ª×¨×’×™×œ:</p>
            <div id="question-display" class="math-block"></div>
            
            <input type="tel" id="answer-input" placeholder="?" autocomplete="off" inputmode="numeric">
            
            <button class="btn" id="check-btn">×‘×“×™×§×”</button>
        </div>

        <!-- ×©×œ×‘ 3: × ×™×¦×—×•×Ÿ -->
        <div id="screen-3" class="game-panel">
            <h1 class="win-title">××–×œ ×˜×•×‘! ğŸ‘‘</h1>
            <div class="note">
                ×œ××‘× ×”×›×™ ×˜×•×‘ ×‘×¢×•×œ×,<br>
                ×¢×‘×¨×ª ××ª ×”××‘×—×Ÿ ×‘×–××Ÿ!<br>
                ×”××•×Ÿ ××–×œ ×˜×•×‘ ×œ×™×•× ×”×”×•×œ×“×ª. ××ª×” ×”××‘× ×”×›×™ ×˜×•×‘ ×©×™×›×•×œ×ª×™ ×œ×‘×§×© ××ª×” ×ª××™×“ ×©× ×‘×©×‘×™×œ×™ ×•×‘×©×‘×™×œ ××¢×™×™×Ÿ <br>
                ××•×”×‘ ××•×ª×š ××œ× ××–×œ ×˜×•×‘! â¤ï¸ 
            </div>
            <button class="btn btn-start" id="confetti-btn">×ª×œ×—×¥ ×œ×¢×•×“ ×§×•× ×¤×˜×™!</button>
        </div>

        <!-- ×©×œ×‘ 4: ×”×¤×¡×“ -->
        <div id="screen-fail" class="game-panel fail-screen">
            <h1 class="fail-text">×’×™×™× ××•×‘×¨!</h1>
            <p id="fail-reason" style="color: white; font-weight: bold; font-size: 1.2rem;">×”×–××Ÿ × ×’××¨...</p>
            <h2 style="color: #ffaaaa; margin-top: 20px;">××ª×” ×œ× ××‘× ×©×œ×™! ğŸ˜¡</h2>
            <button class="btn" id="retry-btn">× ×¡×” ×©×•×‘</button>
        </div>
    </div>

    <script>
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // iOS KEYBOARD FIX
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const appWrapper = document.getElementById('app-wrapper');
        const inputField = document.getElementById('answer-input');
        let isKeyboardOpen = false;
        let initialHeight = window.innerHeight;
        
        function setAppHeight() {
            const vh = window.visualViewport 
                ? window.visualViewport.height 
                : window.innerHeight;
            
            document.documentElement.style.setProperty('--app-height', `${vh}px`);
            
            const heightReduction = initialHeight - vh;
            const keyboardLikelyOpen = heightReduction > 100;
            
            if (keyboardLikelyOpen && !isKeyboardOpen) {
                isKeyboardOpen = true;
                appWrapper.classList.add('keyboard-open');
            } else if (!keyboardLikelyOpen && isKeyboardOpen) {
                isKeyboardOpen = false;
                appWrapper.classList.remove('keyboard-open');
            }
        }

        setAppHeight();
        
        if (window.visualViewport) {
            window.visualViewport.addEventListener('resize', setAppHeight);
            window.visualViewport.addEventListener('scroll', (e) => {
                if (window.visualViewport.offsetTop > 0) {
                    window.scrollTo(0, 0);
                }
            });
        }
        
        window.addEventListener('resize', () => {
            if (!isKeyboardOpen) {
                initialHeight = window.innerHeight;
            }
            setAppHeight();
        });
        
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                initialHeight = window.innerHeight;
                setAppHeight();
            }, 100);
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // PREVENT UNWANTED SCROLLING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        appWrapper.addEventListener('touchmove', function(e) {
            const target = e.target;
            const panel = target.closest('.game-panel');
            
            if (panel && panel.scrollHeight > panel.clientHeight) {
                const isAtTop = panel.scrollTop === 0;
                const isAtBottom = panel.scrollTop + panel.clientHeight >= panel.scrollHeight;
                
                const touch = e.touches[0];
                const lastY = panel.dataset.lastY ? parseFloat(panel.dataset.lastY) : touch.clientY;
                const deltaY = touch.clientY - lastY;
                panel.dataset.lastY = touch.clientY;
                
                if ((isAtTop && deltaY > 0) || (isAtBottom && deltaY < 0)) {
                    e.preventDefault();
                }
                return;
            }
            
            e.preventDefault();
        }, { passive: false });
        
        appWrapper.addEventListener('touchstart', function(e) {
            const panel = e.target.closest('.game-panel');
            if (panel) {
                panel.dataset.lastY = e.touches[0].clientY;
            }
        }, { passive: true });

        document.addEventListener('touchmove', function(e) {
            if (!e.target.closest('.game-panel')) {
                e.preventDefault();
            }
        }, { passive: false });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INPUT FOCUS HANDLING
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        inputField.addEventListener('focus', () => {
            setTimeout(setAppHeight, 100);
            setTimeout(setAppHeight, 300);
            setTimeout(setAppHeight, 500);
        });

        inputField.addEventListener('blur', () => {
            setTimeout(() => {
                isKeyboardOpen = false;
                appWrapper.classList.remove('keyboard-open');
                setAppHeight();
            }, 100);
        });

        inputField.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault();
                checkAnswer();
            }
        });

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // AUDIO SYSTEM
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const soundBuffers = {};
        let bgSource = null;

        const audioFiles = {
            'bg': 'sound.mp3',
            'win': 'sound2.mp4',
            'fail': 'sound3.mp4'
        };

        async function loadSound(name, url) {
            try {
                const response = await fetch(url);
                const arrayBuffer = await response.arrayBuffer();
                const audioBuffer = await audioCtx.decodeAudioData(arrayBuffer);
                soundBuffers[name] = audioBuffer;
            } catch (error) {
                console.error(`Failed to load sound ${name}:`, error);
            }
        }

        async function initAudio() {
            const promises = Object.entries(audioFiles).map(([name, url]) => loadSound(name, url));
            await Promise.all(promises);
            const btn = document.getElementById('init-game-btn');
            btn.innerText = "×™××œ×œ×” ×œ××‘×—×Ÿ";
            btn.disabled = false;
        }
        initAudio();

        function playSound(name, loop = false, volume = 1.0) {
            if (!soundBuffers[name]) return;
            if (name === 'bg' && bgSource) {
                try { bgSource.stop(); } catch(e){}
            }
            const source = audioCtx.createBufferSource();
            source.buffer = soundBuffers[name];
            source.loop = loop;
            const gainNode = audioCtx.createGain();
            gainNode.gain.value = volume;
            source.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            source.start(0);
            if (name === 'bg') bgSource = source;
        }

        function stopBackgroundMusic() {
            if (bgSource) {
                try { bgSource.stop(); } catch(e){}
                bgSource = null;
            }
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // RANDOM QUESTION GENERATOR (Answers max 9000)
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        // Generate a random number within a range
        function randomInRange(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        // Generate all 4 random questions with answers under 9000
        function generateQuestions() {
            const questions = [];
            let n1, n2;

            // Question 1: 2-digit Ã— 2-digit (max ~8100)
            // Keep numbers reasonable: 10-90 Ã— 10-90
            n1 = randomInRange(10, 90);
            n2 = randomInRange(10, 90);
            // Make sure result is under 9000
            while (n1 * n2 > 9000) {
                n1 = randomInRange(10, 90);
                n2 = randomInRange(10, 90);
            }
            questions.push({ n1, op: 'Ã—', n2, ans: n1 * n2 });

            // Question 2: 3-digit Ã— 1-digit (max 999 Ã— 9 = 8991)
            n1 = randomInRange(100, 999);
            n2 = randomInRange(2, 9);
            // Make sure result is under 9000
            while (n1 * n2 > 9000) {
                n1 = randomInRange(100, 999);
                n2 = randomInRange(2, 9);
            }
            questions.push({ n1, op: 'Ã—', n2, ans: n1 * n2 });

            // Question 3: 4-digit - 3-digit (result always positive and under 9000)
            n1 = randomInRange(1000, 8999);
            n2 = randomInRange(100, 999);
            if (n2 > n1) [n1, n2] = [n2, n1];
            questions.push({ n1, op: '-', n2, ans: n1 - n2 });

            // Question 4: Easy one - 2-digit + 2-digit (max 198)
            n1 = randomInRange(10, 99);
            n2 = randomInRange(10, 99);
            questions.push({ n1, op: '+', n2, ans: n1 + n2 });

            return questions;
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // GAME LOGIC
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

        let questions = [];
        let currentQ = 0;
        let timeLeft = 60;
        let lives = 3;
        let timerInterval;
        let isShowingError = false;

        document.getElementById('init-game-btn').addEventListener('click', function() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            startGame();
        });

        document.getElementById('check-btn').addEventListener('click', checkAnswer);
        document.getElementById('confetti-btn').addEventListener('click', moreConfetti);
        document.getElementById('retry-btn').addEventListener('click', () => location.reload());

        function startGame() {
            // Generate fresh random questions each time
            questions = generateQuestions();
            
            // Reset game state
            currentQ = 0;
            timeLeft = 60;
            lives = 3;
            
            playSound('bg', true, 0.5);
            document.getElementById('screen-1').classList.remove('active');
            document.getElementById('screen-2').classList.add('active');
            startTimer();
            loadQuestion();
            updateLives();
            updateQuestionCounter();
        }

        function startTimer() {
            document.getElementById('time-left').style.color = '#fff';
            timerInterval = setInterval(function() {
                timeLeft--;
                document.getElementById('time-left').innerText = timeLeft;
                if (timeLeft <= 10) {
                    document.getElementById('time-left').style.color = '#ffcccb';
                }
                if (timeLeft <= 0) {
                    gameOver("× ×’××¨ ×”×–××Ÿ!");
                }
            }, 1000);
        }

        function updateLives() {
            let hearts = "";
            for(let i=0; i<lives; i++) hearts += "â¤ï¸";
            document.getElementById('lives-display').innerText = hearts;
        }

        function updateQuestionCounter() {
            document.getElementById('question-counter').innerText = `${currentQ + 1}/${questions.length}`;
        }

        function gameOver(reason) {
            clearInterval(timerInterval);
            stopBackgroundMusic();
            playSound('fail', false, 1.0);
            document.getElementById('fail-reason').innerText = reason;
            document.getElementById('screen-2').classList.remove('active');
            document.getElementById('screen-fail').classList.add('active');
            if (navigator.vibrate) navigator.vibrate(400);
        }

        function loadQuestion() {
            const q = questions[currentQ];
            document.getElementById('question-display').innerHTML = 
                `<span>${q.n1}</span> <span>${q.op}</span> <span>${q.n2}</span>`;
            document.getElementById('answer-input').value = '';
            updateQuestionCounter();
        }

        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        // INLINE ERROR DISPLAY IN INPUT BOX
        // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        
        function showInputError() {
            if (isShowingError) return;
            isShowingError = true;
            
            const input = document.getElementById('answer-input');
            const originalPlaceholder = input.placeholder;
            
            input.classList.add('input-error');
            input.value = 'ğŸ’”!×˜×¢×•×ª';
            input.disabled = true;
            input.readOnly = true;
            
            if (navigator.vibrate) navigator.vibrate(200);
            
            setTimeout(() => {
                input.classList.remove('input-error');
                input.value = '';
                input.placeholder = originalPlaceholder;
                input.disabled = false;
                input.readOnly = false;
                isShowingError = false;
                
                if (lives === 0) {
                    gameOver("× ×’××¨×• ×”×—×™×™×");
                } else {
                    input.focus();
                }
            }, 1000);
        }

        function checkAnswer() {
            if (isShowingError) return;
            
            const input = document.getElementById('answer-input');
            const val = input.value.trim();
            
            if (val === "") return;
            
            const correct = questions[currentQ].ans;

            if (parseInt(val) === correct) {
                currentQ++;
                if (currentQ < questions.length) {
                    loadQuestion();
                } else {
                    finishGame();
                }
            } else {
                lives--;
                updateLives();
                showInputError();
            }
        }

        function finishGame() {
            clearInterval(timerInterval);
            stopBackgroundMusic();
            playSound('win', false, 1.0);
            document.getElementById('screen-2').classList.remove('active');
            document.getElementById('screen-3').classList.add('active');
            inputField.blur();
            moreConfetti();
            setInterval(moreConfetti, 2500);
        }

        function moreConfetti() {
            confetti({ 
                particleCount: 100, 
                spread: 70, 
                origin: { y: 0.6 }, 
                colors: ['#E52521', '#43B047', '#FFD700', '#0099ff'] 
            });
        }
    </script>
</body>
</html>
